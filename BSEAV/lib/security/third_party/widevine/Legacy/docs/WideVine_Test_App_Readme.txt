###########################################################################################
###
###           Widevine Playback Test App Readme
###
###########################################################################################

This README describes the runtime environment required to test the Widevine playback test app with refsw


The following is a list of the binaries:

  -  TestWVPlayback
  -  tvtest.sh
  -  WIDEVINE_SETTOP_KEYBOX_00000000.bin
  -  bcmdriver.ko
  -  nexus (nexus.client)
  -  libnexus.so
  -  libNexusMgr.so
  -  libPlaybackDevice.so
  -  libWVPlaybackAPI.so
  -  libWVStreamControlAPI.so
  -  libcmncrypto.so
  -  libcmndrm.a (libcmndrm.so)
  -  libb_os.a (libb_os.so)
  -  libcrypt-0.9.32.so (libcrypt.so libcrypt.so.0)
  -  libcrypto.so (libcrypto.so.0.9.8)
  -  libcurl.so (libcurl.so.4 libcurl.so.4.2.0)
  -  libssl.so (libssl.so.0.9.8)
  -  libcurl.so
  -  libxml2.so
  -  logger

See the "Component Descriptions" section below for more information


#########################################################
###Build and run Widevine test app in refsw Environment
#########################################################

1. The user should create a refsw view according to a specific phase release's config spec. Make sure the

2. The playbackdevice library needed by widevine is located in AppLibs/broadcom/playbackdevice

4. set the LINUX and TOOLCHAIN export variables as per the platform and refsw. Make sure the following exports are set

export PLATFORM="97425" or as per your platform
export BCHP_VER="B1" or as per your platform
export BCHP_CHIP=7425 or as per your platform
export BCHP_ENDIAN=le
export LINUX=/opt/brcm/linux/stblinux-2.6.37-2.8/stblinux-2.6.37
export TOOLCHAIN=/opt/toolchains/stbgcc-4.5.3-1.3
export PATH=$TOOLCHAIN/bin:$PATH
CC_PATH=<your working folder>
export NEXUS=~/$CC_PATH/nexus
export MAGNUM=~/$CC_PATH/magnum
export BSEAV_TOP=~/$CC_PATH/BSEAV

export TOOLCHAIN_ROOT=$TOOLCHAIN
export SC_PLATFORM=nexus
export PLAYBACKDEVICE_STAND_ALONE_APPLICATION=y
export APPLIBS_TOP=~/$CC_PATH/AppLibs
export NEXUS_COMMON_CRYPTO_SUPPORT=y


4. Build refsw from nexus/build "make all"

5. Build the playbackdevice from BSEAV/lib/playbackdevice "make all"

7.Build the widevine app from BSEAV/lib/security/third_party/widevine/example "make clean all install" . make install will copy the appand the script to nexus/bin folder

8.once all the above components are built, copy the playbackdevice libraries which are in playbackdevice/bin, widevine libraries from widevine/lib to nexus/bin folder.
9. boot the target board and do the following


 i.mount -t nfs <server ip> <dest dir e.g. nexus/bin> /mnt/nfs
 ii.  cd /mnt/nfs
 iii. copy the widevine key file WIDEVINE_SETTOP_KEYBOX_00000000.bin to usr/local/bin/trellis. you can download it from http://twiki-01.broadcom.com/pub/Bseavsw/Security/WIDEVINE_SETTOP_KEYBOX_00000000.bin
 iv. run the tvtest.sh script to start the test.




9. If your config spec has not loaded the Common Crypto/DRM binaries under BSEAV/lib/common_crypto and BSEAV/lib/security you should
   add the following element/load rules to your config spec and "re-setcs" your view:

     element /vobs/BSEAV/lib/common_crypto/...  <LABEL or /main/LATEST>
     element /vobs/BSEAV/lib/security/...       <LABEL or /main/LATEST>

     load /vobs/BSEAV/lib/common_crypto
     load /vobs/BSEAV/lib/security

   *** It is possible that a security Widevine drop was created for your specific chip/phase release.
       Check with a member of the STB security team if this is the case



#################################
###     Component Descriptions
#################################

  -  TestWVPlayback

Widevine executable.  The caller should run (and/or modify) the tvtest.sh script described below in order to execute the test app rather than calling it directly.

   -  tvtest.sh
Script used to setup the WV test app playback environment.  It reads as follows and should be modified to fit the tester's needs:

	export URL=http://edge.cinemanow.com.edgesuite.net/adaptive/studio/get_smart_c68b8145_wv_SD.vob
	export WV_DRM=http://wstfcps005.shibboleth.tv/widevine/cypherpc/cgi-bin
	export LD_LIBRARY_PATH=.:/nexus.bin:/refsw

	./nexus TestWVPlayback -url $URL drm_server_url=$WV_DRM/GetEMMs.cgi drm_ack_server_url=$WV_DRM/Ack.cgi drm_heartbeat_url=$WV_DRM/Heartbeat.cgi poertal=OEM drm_key_bin=./WIDEVINE_SETTOP_KEYBOX_00000000.bin



  -  WIDEVINE_SETTOP_KEYBOX_00000000.bin
DRM bin file generated by STB security team which contains encrypted keybox information

  -  bcmdriver.ko
Broadcom driver

  -  nexus
Runtime script used to insmod the Broadcom driver

  -  libnexus.so
Nexus library

  -  libPlaybackDevice.so
Playback devices module library (BSEAV/lib/playbackdevice/bin)

libNexusMgr.so
nexus manager library(BSEAV/lib/playbackdevice/bin)

  -  libWVPlaybackAPI.so
  -  libWVStreamControlAPI.so
Widevine binaries (BSEAV/lib/security/third_party/widevine/lib)

  -  libcmncrypto.so
  -  libcmndrm.a (libcmndrm.so)
The Common Crypto and Common DRM libraries (BSEAV)


The following libraries are obtained via AppLibs and BSEAV for that specific platform:
  -  libb_os.a (libb_os.so)
  -  libcrypt-0.9.32.so (libcrypt.so libcrypt.so.0)
  -  libcrypto.so (libcrypto.so.0.9.8)
  -  libcurl.so (libcurl.so.4 libcurl.so.4.2.0)
  -  libssl.so (libssl.so.0.9.8)
  -  libxml2.so
  -  libcurl.so
  -  logger
