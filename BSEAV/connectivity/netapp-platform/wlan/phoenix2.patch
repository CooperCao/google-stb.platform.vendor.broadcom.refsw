diff -BNru phoenix2dhd-1-66_rel_6_10_166_3_org/src/dhd/linux/Makefile phoenix2dhd-1-66_rel_6_10_166_3/src/dhd/linux/Makefile
--- phoenix2dhd-1-66_rel_6_10_166_3_org/src/dhd/linux/Makefile	2012-12-12 14:14:09.000000000 -0500
+++ phoenix2dhd-1-66_rel_6_10_166_3/src/dhd/linux/Makefile	2012-12-24 11:02:45.055318620 -0500
@@ -304,9 +304,9 @@
   CFILES += dhd_sdio.c bcmsdh_sdmmc.c bcmsdh.c bcmsdh_linux.c bcmsdh_sdmmc_linux.c
 endif

-ifeq ($(call wlan_version_ge,$(BCM_KVERSIONSTRING),2.6.35),TRUE)
-DFLAGS += -DARP_OFFLOAD_SUPPORT
-endif
+#ifeq ($(call wlan_version_ge,$(BCM_KVERSIONSTRING),2.6.35),TRUE)
+#DFLAGS += -DARP_OFFLOAD_SUPPORT
+#endif
 ifneq ($(findstring -android-,-$(TARGET)-),)
   DFLAGS += -DOEM_ANDROID -Dlinux -DBCMDBG
   DFLAGS += -DCUSTOMER_HW2 -DEMBEDDED_PLATFORM -DKEEP_ALIVE
diff -BNru phoenix2dhd-1-66_rel_6_10_166_3_org/src/dhd/sys/dhd_linux.c phoenix2dhd-1-66_rel_6_10_166_3/src/dhd/sys/dhd_linux.c
--- phoenix2dhd-1-66_rel_6_10_166_3_org/src/dhd/sys/dhd_linux.c	2012-12-12 14:14:09.000000000 -0500
+++ phoenix2dhd-1-66_rel_6_10_166_3/src/dhd/sys/dhd_linux.c	2012-12-24 11:00:52.751313318 -0500
@@ -36,6 +36,7 @@
 #include <linux/ethtool.h>
 #include <linux/fcntl.h>
 #include <linux/fs.h>
+#include <linux/rtnetlink.h>

 #include <asm/uaccess.h>
 #include <asm/unaligned.h>
@@ -4298,6 +4299,11 @@
		ret = -ENXIO;
		goto fail;
	}
+
+	rtnl_lock();
+	dev_open(((dhd_info_t *)pub->info)->iflist[0]->net);
+	rtnl_unlock();
+
 #ifdef BCM_FD_AGGR
	pub->info->rpc_th = bcm_rpc_tp_attach(osh, (void *)pub->dbus);
	if (!pub->info->rpc_th) {
diff -BNru phoenix2dhd-1-66_rel_6_10_166_3_org/src/usbdev/usbdl/Makefile phoenix2dhd-1-66_rel_6_10_166_3/src/usbdev/usbdl/Makefile
--- phoenix2dhd-1-66_rel_6_10_166_3_org/src/usbdev/usbdl/Makefile	2012-12-12 14:14:09.000000000 -0500
+++ phoenix2dhd-1-66_rel_6_10_166_3/src/usbdev/usbdl/Makefile	2012-12-24 11:00:52.751313318 -0500
@@ -40,21 +40,19 @@
 ifeq ($(TARGETENV), linuxmips_be)
	OBJECTS += $(ObjPfx)usb_linux.o
	COMPILE = mips-linux-gcc
-	LIBS := -L$(LIBUSB_PATH)/.libs $(LIBUSB_PATH)/.libs/libusb.a
-	CFLAGS += -I$(LIBUSB_PATH) -DIL_BIGENDIAN
+	LIBS := -L$(LIBUSB_PATH)/lib $(LIBUSB_PATH)/lib/libusb.a
+	CFLAGS += -I$(LIBUSB_PATH)/include -DIL_BIGENDIAN
 endif


 ifeq ($(TARGETENV), linuxmips)
	TARGET_PREFIX := mipsel-linux-
	OBJECTS += $(ObjPfx)usb_linux.o
-	CFLAGS += -I ../libusb
	COMPILE = mipsel-linux-gcc
	CLEAN = clean_linux
-	LDFLAGS += -L$(LIBUSB_PATH)/.libs
-	LIBS= ../libusb/.libs/libusb.a
-	LIBS := -L$(LIBUSB_PATH)/.libs $(LIBUSB_PATH)/.libs/libusb.a
-	CFLAGS += -I$(LIBUSB_PATH)
+	LDFLAGS += -L$(LIBUSB_PATH)/lib
+	LIBS := -L$(LIBUSB_PATH)/lib $(LIBUSB_PATH)/lib/libusb.a
+	CFLAGS += -I$(LIBUSB_PATH)/include
 #It is wrong to put install target here, affect the rest of ifeq tests
 #install:
 #	cp bcmdl $(SRCBASE)/router/mipsel-uclibc/target/bin
@@ -91,11 +89,9 @@
	TARGET := $(ObjPfx)bcmdl
	COMPILE := $(CC)
	LDFLAGS += $(CROSS_LD_PATH)
-	LDFLAGS += -L$(LIBUSB_PATH)/.libs
-	LIBS= ../libusb/.libs/libusb.a
-	LIBS := -L$(LIBUSB_PATH)/.libs $(LIBUSB_PATH)/.libs/libusb.a
-	CFLAGS += -I ../libusb
-	CFLAGS += -I$(LIBUSB_PATH)
+	LDFLAGS += -L$(LIBUSB_PATH)/libs
+	LIBS := -L$(LIBUSB_PATH)/libs $(LIBUSB_PATH)/libs/libusb.a
+	CFLAGS += -I$(LIBUSB_PATH)/include
 endif

 ifeq ($(BCMQT),1)
diff -BNru phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpsapi/common/include/wps_api_osl.h phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpsapi/common/include/wps_api_osl.h
--- phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpsapi/common/include/wps_api_osl.h	2012-12-12 14:14:14.000000000 -0500
+++ phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpsapi/common/include/wps_api_osl.h	2012-12-24 11:00:52.751313318 -0500
@@ -61,7 +61,7 @@
 extern char *wps_osl_get_short_adapter_name();
 extern int wps_osl_get_mac(uint8 *mac);
 extern char *wps_osl_get_ssid();
-extern uint32 wps_osl_init(void *cb_ctx, void *cb, const char *adapter_id);
+extern uint32 wps_osl_init(void *cb_ctx, void *cb, const char *adapter_id, const char* bridge_id);
 extern void wps_osl_deinit();
 extern void wps_osl_abort();
 extern uint32 wps_osl_setup_802_1x(uint8 *bssid);
diff -BNru phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpsapi/common/include/wps_sdk.h phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpsapi/common/include/wps_sdk.h
--- phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpsapi/common/include/wps_sdk.h	2012-12-12 14:14:14.000000000 -0500
+++ phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpsapi/common/include/wps_sdk.h	2012-12-24 11:00:52.751313318 -0500
@@ -276,6 +276,8 @@
  * Function : wps_api_open
  * Parameters :
  *		adapter_id - Adapter identifier
+ *		bridge_id Bridge adaptor name that the interface is connected too (the interface to
+ *		listen for events on)
  *		cb_ctx  - Optional. If provided, the WPS status callback
  *			will be called with this context.
  *		callback - WPS status callback.
@@ -302,10 +304,10 @@
  *			serial Number = "5678"
  */
 #ifdef WFA_WPS_20_TESTBED
-BCM_WPSAPI bool wps_api_open(const char *adapter_id, void *cb_ctx, fnWpsProcessCB callback,
+BCM_WPSAPI bool wps_api_open(const char *adapter_id, const char* bridge_id, void *cb_ctx, fnWpsProcessCB callback,
	wps_devinf *devinf, wps20_testbed_inf *wps20_tbinf, bool ap_pin, bool version2);
 #else
-BCM_WPSAPI bool wps_api_open(const char *adapter_id, void *cb_ctx, fnWpsProcessCB callback,
+BCM_WPSAPI bool wps_api_open(const char *adapter_id, const char* bridge_id, void *cb_ctx, fnWpsProcessCB callback,
	wps_devinf *devinf, bool ap_pin, bool version2);
 #endif

diff -BNru phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpsapi/common/wps_api.c phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpsapi/common/wps_api.c
--- phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpsapi/common/wps_api.c	2012-12-12 14:14:14.000000000 -0500
+++ phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpsapi/common/wps_api.c	2012-12-24 11:00:52.751313318 -0500
@@ -732,10 +732,10 @@
 /* wps_api_open function must be called first, before any other wps api call */
 BCM_WPSAPI bool
 #ifdef WFA_WPS_20_TESTBED
-wps_api_open(const char *adapter_id, void *cb_ctx, fnWpsProcessCB callback, wps_devinf *devinf,
+wps_api_open(const char *adapter_id, const char* bridge_id, void *cb_ctx, fnWpsProcessCB callback, wps_devinf *devinf,
	wps20_testbed_inf *wps20_tbinf, bool ap_pin, bool b_v2)
 #else
-wps_api_open(const char *adapter_id, void *cb_ctx, fnWpsProcessCB callback, wps_devinf *devinf,
+wps_api_open(const char *adapter_id, const char* bridge_id, void *cb_ctx, fnWpsProcessCB callback, wps_devinf *devinf,
	bool ap_pin, bool b_v2)
 #endif /* WFA_WPS_20_TESTBED */
 {
@@ -794,7 +794,7 @@
	wps_api_status_cb(&wps_api_wksp->cb, wps_api_wksp->cb_ctx, WPS_STATUS_INIT, NULL);

	/* WPS hook init for adapter and led (HW) */
-	if (wps_hook_init(cb_ctx, callback, adapter_id) == false) {
+	if (wps_hook_init(cb_ctx, callback, adapter_id, bridge_id) == false) {
		TUTRACE((TUTRACE_ERR, "wps_api_open : Failed to initial wireless adapter.\n"));
		return false;
	}
diff -BNru phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpsapi/common/wps_api_priv.h phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpsapi/common/wps_api_priv.h
--- phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpsapi/common/wps_api_priv.h	2012-12-12 14:14:14.000000000 -0500
+++ phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpsapi/common/wps_api_priv.h	2012-12-24 11:00:52.751313318 -0500
@@ -35,7 +35,7 @@

 extern bool wps_hook_create_profile(const struct _wps_credentials *credentials);
 extern int wps_hook_get_mac(uint8 *mac);
-extern bool wps_hook_init(void *cb_ctx, void *cb, const char *adapter_id);
+extern bool wps_hook_init(void *cb_ctx, void *cb, const char *adapter_id, const char* bridge_id);
 extern void wps_hook_deinit();
 extern void wps_hook_abort();
 extern uint32 wps_hook_setup_802_1x(char *bssid);
diff -BNru phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpsapi/common/wps_hooks.c phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpsapi/common/wps_hooks.c
--- phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpsapi/common/wps_hooks.c	2012-12-12 14:14:14.000000000 -0500
+++ phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpsapi/common/wps_hooks.c	2012-12-24 11:00:52.751313318 -0500
@@ -61,9 +61,9 @@

 /* Initial HW related */
 bool
-wps_hook_init(void *cb_ctx, void *cb, const char *adapter_id)
+wps_hook_init(void *cb_ctx, void *cb, const char *adapter_id, const char * bridge_id)
 {
-	uint32 retVal = wps_osl_init(cb_ctx, cb, adapter_id);
+	uint32 retVal = wps_osl_init(cb_ctx, cb, adapter_id, bridge_id);
	return ((retVal == WPS_OSL_SUCCESS) ? true : false);
 }

diff -BNru phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpsapi/linux/wps_api_tester.c phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpsapi/linux/wps_api_tester.c
--- phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpsapi/linux/wps_api_tester.c	2012-12-12 14:14:14.000000000 -0500
+++ phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpsapi/linux/wps_api_tester.c	2012-12-24 11:00:52.751313318 -0500
@@ -343,11 +343,11 @@

	/* 2. Open WPS */
 #ifdef WFA_WPS_20_TESTBED
-	bRet = wps_api_open(STRP(wps->ifname), NULL, _wps_join_callback,
+	bRet = wps_api_open(STRP(wps->ifname), STRP(wps->brname), NULL, _wps_join_callback,
		_wps_my_devinf(&my_devinf, wps->transport_uuid), &wps->wps20_tbinf, wps->b_appin,
		wps->b_v2);
 #else
-	bRet = wps_api_open(STRP(wps->ifname), NULL, _wps_join_callback,
+	bRet = wps_api_open(STRP(wps->ifname), STRP(wps->brname), NULL, _wps_join_callback,
		_wps_my_devinf(&my_devinf, wps->transport_uuid), wps->b_appin, wps->b_v2);
 #endif
	if (bRet == FALSE) {
diff -BNru phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpsapi/linux/wps_api_tester.h phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpsapi/linux/wps_api_tester.h
--- phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpsapi/linux/wps_api_tester.h	2012-12-12 14:14:14.000000000 -0500
+++ phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpsapi/linux/wps_api_tester.h	2012-12-24 11:00:52.751313318 -0500
@@ -30,6 +30,7 @@
	char bssid[6];
	char ssid[33];
	char ifname[16];
+	char brname[16];
	char def_dhclient_pf[256];
	char ip_addr[16];
	char dhcp_cmd[256];
diff -BNru phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpsapi/linux/wps_api_ui.c phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpsapi/linux/wps_api_ui.c
--- phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpsapi/linux/wps_api_ui.c	2012-12-12 14:14:14.000000000 -0500
+++ phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpsapi/linux/wps_api_ui.c	2012-12-24 11:00:52.755313316 -0500
@@ -973,6 +973,11 @@
			val = argv[index++]; argc--;
			wps_strncpy(wps->ifname, val, sizeof(wps->ifname));
		}
+		else if (!strcmp(cmd, "-br")) {
+			WPS_ARGC_CHECK();
+			val = argv[index++]; argc--;
+			wps_strncpy(wps->brname, val, sizeof(wps->brname));
+		}
		else if (!strcmp(cmd, "-bssid")) {
			WPS_ARGC_CHECK();
			/*
diff -BNru phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpsapi/linux/wps_linux_osl.c phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpsapi/linux/wps_linux_osl.c
--- phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpsapi/linux/wps_linux_osl.c	2012-12-12 14:14:14.000000000 -0500
+++ phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpsapi/linux/wps_linux_osl.c	2012-12-24 11:00:52.755313316 -0500
@@ -93,6 +93,8 @@
 WPS_OSL_T *wps_osl_wksp = NULL;

 static char ifname_lx[IFNAMSIZ] = "";
+static char ifname_br[IFNAMSIZ] = "";
+
 static uint8 peer_mac[6] = {0};
 static int eap_fd = -1; /* descriptor to raw socket  */
 static int ifindex = -1; /* interface index */
@@ -158,6 +160,12 @@

	ifr.ifr_name[0] = '\0';

+	if (ifname_br[0] != '\0')
+	{
+		strncpy(ifname, ifname_br, ifname_len);
+		return 0;
+	}
+
	if (!(fp = fopen(proc_net_dev, "r")))
		return ret;

@@ -630,7 +638,7 @@
		memcpy(peer_mac, bssid, 6);

	memset(&ifr, 0, sizeof(ifr));
-	wps_strncpy(ifr.ifr_name, ifname_lx, sizeof(ifr.ifr_name));
+	wps_strncpy(ifr.ifr_name, ifname_br[0] ? ifname_br : ifname_lx, sizeof(ifr.ifr_name));

	err = ioctl(eap_fd, SIOCGIFINDEX, &ifr);
	if (err < 0) {
@@ -644,7 +652,6 @@

	ll.sll_family = PF_PACKET;
	ll.sll_ifindex = ifr.ifr_ifindex;
-	ifindex  = ifr.ifr_ifindex;
	ll.sll_protocol = htons(ETH_8021X_PROT);
	if (bind(eap_fd, (struct sockaddr *) &ll, sizeof(ll)) < 0) {
		WPS_DEBUG(("Bind interface failed\n"));
@@ -653,6 +660,16 @@
		return WPS_OSL_ERROR;
	}

+	wps_strncpy(ifr.ifr_name, ifname_lx, sizeof(ifr.ifr_name));
+	err = ioctl(eap_fd, SIOCGIFINDEX, &ifr);
+	if (err < 0) {
+		WPS_DEBUG(( "Get interface index failed\n"));
+		close(eap_fd);
+		eap_fd = -1;
+		return WPS_OSL_ERROR;
+	}
+	ifindex  = ifr.ifr_ifindex;
+
	return WPS_OSL_SUCCESS;
 }

@@ -840,7 +857,7 @@
 }

 uint32
-wps_osl_init(void *cb_ctx, void *cb, const char *adapter_id)
+wps_osl_init(void *cb_ctx, void *cb, const char *adapter_id, const char* bridge_id)
 {
	char *ifname = (char*) adapter_id;
	char dyn_name[IFNAMSIZ];
@@ -869,6 +886,11 @@
		ifname = dyn_name;
	}

+	if (bridge_id != NULL)
+	{
+	    wps_strncpy(ifname_br, bridge_id, sizeof(ifname_br));
+	}
+
	/* Save this specific interface for further use */
	wps_strncpy(ifname_lx, ifname, sizeof(ifname_lx));

@@ -925,6 +947,8 @@
		free(wps_osl_wksp);
		wps_osl_wksp = NULL;
	}
+    memset(ifname_br, 0, sizeof(ifname_br));
+    memset(ifname_lx, 0, sizeof(ifname_lx));
 }

 void
diff -BNru phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpscli/common/wpscli_wl.c phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpscli/common/wpscli_wl.c
--- phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpscli/common/wpscli_wl.c	2012-12-12 14:14:14.000000000 -0500
+++ phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpscli/common/wpscli_wl.c	2012-12-24 11:00:52.755313316 -0500
@@ -740,7 +740,7 @@
		proberesp->primDeviceOui = devinfo->primDeviceOui;
		proberesp->primDeviceSubCategory = devinfo->primDeviceSubCategory;
		strcpy(proberesp->deviceName, devinfo->deviceName);
-		proberesp->configMethods = devinfo->configMethods & ~WPS_CONFMET_PBC;
+		proberesp->configMethods = devinfo->configMethods;
		proberesp->rfBand = devinfo->rfBand;
		if (b_wps_version2) {
			proberesp->version2 = devinfo->version2;
diff -BNru phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpscli/linux/Makefile phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpscli/linux/Makefile
--- phoenix2dhd-1-66_rel_6_10_166_3_org/src/wps/wpscli/linux/Makefile	2012-12-12 14:14:14.000000000 -0500
+++ phoenix2dhd-1-66_rel_6_10_166_3/src/wps/wpscli/linux/Makefile	2012-12-24 11:00:52.755313316 -0500
@@ -48,6 +48,12 @@
 CFLAGS += -DWPSCLI_NO_WPS_LOOP
 endif

+ifeq ($(BCM_P2P_IOTYPECOMPAT),1)
+  CFLAGS += -DBCM_P2P_IOTYPECOMPAT
+endif
+ifeq ($(BCM_P2P_ACRATES),1)
+  CFLAGS += -DBCM_P2P_ACRATES
+endif

 WPSCLIBASEDIR:= $(SRCBASE)/wps/wpscli
 WPSLIBDIR    := $(WPSCLIBASEDIR)/linux
