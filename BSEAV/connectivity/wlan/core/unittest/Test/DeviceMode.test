#!/bin/env utf
# -*-tcl-*-
#

#
# UTF test script to configure devicemode
#
# Written by: Robert J. McMahon February 2105
#
# $Copyright Broadcom Corporation$
#
package require UTF

package provide UTF::Test::DeviceMode 2.0

UTF::Test DeviceMode {args} {
    UTF::Getopts {
	{ap.arg "" "APs under test"}
	{mode.arg "1" "Router device mode value"}
    }
    UTF::Try "$(ap) Devicemode=$(mode)" {
	set wlname [$(ap) wlname]
	set nvram "router_disable=0 "
	append nvram "wl_wmf_bss_enable=1 "
	append nvram "wl_reg_mode=h "
	append nvram "${wlname}_reg_mode=h "
	append nvram "wl_taf_enable=1 "
	append nvram "wl_taf_enable=0x15 "
	append nvram "wl_ebos_enable=0 "
	append nvram "wl_ebos_flags=0x68 "
	append nvram "wl_ebos_prr_flags=0xa41 "
	append nvram "wl_ebos_prr_threshold=0x0f0000001 "
	append nvram "wl_ebos_prr_transit=-1 "
	append nvram "wl_atf=1 "
	append nvram "emf_enable=1 "
	append nvram "wl_wmf_ucigmp_query=1 "
	append nvram "wl_wmf_ucast_upnp=1 "
	append nvram "wl_wmf_igmpq_filter=1 "
	append nvram "wl_acs_fcs_mode=1 "
	append nvram "${wlname}_acs_fcs_mode=1 "
	append nvram "wl_acs_dfs=2 "
	append nvram "${wlname}_acs_dfs=2 "
	append nvram "wl_dcs_csa_unicast=1 "
	append nvram "${wlname}_dcs_csa_unicast=1 "
	append nvram "wl_acs_excl_chans=0xd98e,0xd88e,0xe28a,0xe38a "
	append nvram "${wlname}_acs_excl_chans=0xd98e,0xd88e,0xe28a,0xe38a "
	append nvram "wl_pspretend_retry_limit=5 "
	append nvram "${wlname}_pspretend_retry_limit=5 "
	append nvram "wl_pspretend_threshold=0 "
	append nvram "${wlname}_pspretend_threshold=0 "
	append nvram "wl_acs_chan_dwell_time=70 "
	append nvram "${wlname}_acs_chan_dwell_time=70 "
	append nvram "wl_frameburst=on "
	append nvram "${wlname}_frameburst=on "
	append nvram "frameburst_dyn=0 "
	append nvram "wl_amsdu=off "
	append nvram "${wlname}_amsdu=off "
	append nvram "wl_rx_amsdu_in_ampdu=off "
	append nvram "${wlname}_rx_amsdu_in_ampdu=off "
	append nvram "wl_psta_inact=0"
	append nvram "${wlname}_psta_inact=0 "
	append nvram "wl_cal_period=0 "
	append nvram "${wlname}_cal_period=0 "
	append nvram "wl_msglevel2=0x80000000 "
	append nvram "${wlname}_msglevel2=0x80000000 "
	append nvram "wl_msglevel=0x21280101 "
	append nvram "${wlname}_msglevel=0x21280101 "
	eval [concat $(ap) restart $nvram]
    }
}

