#!/bin/env utf
# -*-tcl-*-
#
# SWWLAN-43934 UTF: 4360 SoftAP frameburst sticks and cannot be reset until down/up
#
# $Id: fe20669781403929fdeb89e8d31e632fb5f3e444 $
# $Copyright Broadcom Corporation$
#

package require UTF
package require UTF::Test::ConnectAPSTA

UTF::Test SWWLAN-43934 {AP STA} {


    $AP configure \
	-pre_perf_hook {{%S wl ampdu_clear_dump}} \
	-post_perf_hook {{%S wl dump ampdu}}

    $AP reload
    $AP wl dump txc
    $AP wl frameburst 1
    $AP wl dump txc

    ConnectAPSTA $AP $STA -security open -chanspec 36l


    $AP wl ampdu_clear_dump
    $AP wl dump txc
    UTF::Multiperf [list $AP $STA] -i 2 -t 2
    $AP wl dump txc
    $AP wl dump ampdu

    $AP wl frameburst 0

    UTF::Sleep 1

#    $AP wl txc_sticky 0
#    UTF::Sleep 2
#    $AP wl txc_sticky 1
    $AP wl dump txc

    $AP wl ampdu_clear_dump
    $AP wl dump txc
    UTF::Multiperf [list $AP $STA] -i 2 -t 4
    $AP wl dump txc
    $AP wl dump ampdu

    $AP wl down
    $AP wl up

    $AP wl ampdu_clear_dump
    $AP wl dump txc
    UTF::Multiperf [list $AP $STA] -i 2 -t 4
    $AP wl dump txc
    $AP wl dump ampdu

}
