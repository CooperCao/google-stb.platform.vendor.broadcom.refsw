#!/bin/env utf
# -*-tcl-*-

# UTF test script for stress testing media routers by sending
# bidirectional trafic at max rate
#
# $Id: a472ff62b5706b41cc0a8b2bc3cba8bbd38f0b60 $
#

package require UTF
package require UTF::Test::controlchart
package require UTF::Test::ConnectAPSTA

package provide UTF::Test::Media::Stress 2.0

UTF::Test Media::Stress {AP STA args} {
    UTF::Getopts {
	{chanspec.arg "36l" "Chanspec"}
	{build.arg "auto" "Build"}
	{security.arg "open" "Security"}
	{loop.arg "50"}
    }

    if {$(build) eq "auto"} {
	set $(build) [$AP branchname]
    }

    UTF::Test::ConnectAPSTA $AP $STA -security $(security) -chanspec $(chanspec)

    $AP wl frameburst 1
    $STA wl frameburst 1

    UTF::Test::controlchart [list $AP $STA $STA $AP] \
	-key [list $(build) "MediaStress" $AP] \
	-window [$STA tcpautowindow] \
	-loop $(loop) -history $(loop)
}
