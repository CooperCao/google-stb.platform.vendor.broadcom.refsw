#!/bin/env utf
# -*-tcl-*-

# Test to see if the current UTF workspace is up to date.  Updating
# has to be done before UTF runs, but we can validate here to so that
# the status can be in a test report.
#
# $Id: b7d240d6333045c6dad1473b4b9923a608a663d5 $
# $Copyright Broadcom Corporation$
#

package provide UTF::Test::utfstatus 2.0

package require UTF

UTF::Test utfstatus {} {
    if {[file isdirectory $::UTF::unittest/.svn]} {
	set ret [localhost svn status -uq]
	# revision line appears in older svn versions despite -q
	regsub {\n?Status against revision.*} $ret {} ret
	if {$ret ne ""} {
	    set ::UTF::warn "Your branch requires SVN updates"
	    UTF::Message WARN "" $::UTF::warn
	    set ret ""
	}
    } else {
	# git status on fc11 returns error code even if up to date.
	catch {localhost git status} ret
	if {![regexp -line {Your branch is .*} $ret ret]} {
	    set ret ""
	} elseif {![regexp {up-to-date} $ret]} {
	    set ::UTF::warn $ret
	    UTF::Message WARN "" $::UTF::warn
	    set ret ""
	}
    }
    set ret
}


