#!/bin/env utf
# -*-tcl-*-

#
# UTF test script for wl hardware diagnostics
# $Id$
# $Copyright Broadcom Corporation$
#

package require UTF

package provide UTF::Test::Diagnostic 2.0

UTF::Test Diagnostic {STA} {

    #Diagnostic preceeds by wl down and then followed by wl up.
    $STA wl down
    $STA wl clk 1

    set BandTests {
        1 Interrupt
        2 Loopback
    }

    set NonBandTests {
        3 Memory
        4 Led
    }
    set errors ""
    set oldband [$STA wl band]
    foreach band [$STA wl bands] {
	$STA wl band $band

	foreach {t name} $BandTests {
	    set msg [$STA wl diag $t]
	    if {[regexp {failed} $msg]} {
		lappend errors "$name($band): $msg"
	    }
	}
    }
    $STA wl band $oldband
    foreach {t name} $NonBandTests {
	set msg [$STA wl diag $t]
	if {[regexp {failed} $msg]} {
	    lappend errors "$name: $msg"
	}
    }
    $STA wl up
    if {[llength $errors]} {
	error $errors
    } else {
	return
    }
}
