#!/bin/sh -Eu
# -E: ERR trap is inherited by shell functions.
# -u: Treat unset variables as an error when substituting.
#
# MFG test script to launch Python LitePoint test.
#
# $Copyright Broadcom Corporation$
#

# Check for 2 tokens minimum.
if [ "$2" == "" ]
then
   echo "ERROR: You must specify 2 calling tokens minimum."
   echo "mfg_run_python test_location test_to_run"
   exit 1
fi

trap_err()
{
	local exit_status=${1:-$?}
  	echo "***Python LitePoint Test Failed."
	echo Exiting $0 with $exit_status
	exit $exit_status
}

#  Trap non-normal exit signals: 1/HUP, 2/INT, 3/QUIT, 15/TERM, ERR
trap trap_err 1 2 3 15 ERR
set -e
set -u

PYTHONPATH='/projects/hnd/tools/python:/projects/hnd_software/lpt_common/src/tools/wlan/litepoint/pkg'
# VLLIB='/projects/boards/work/bradleyd/boards/lib/tempDxD'
WLAN='/projects/hnd_software/lpt_common/src/tools/wlan/'
export PYTHONPATH VLLIB WLAN

cd $1

python ./$2

rc=$?
echo $rc

if [ "$rc" -ne "0" ]; then
  echo "***Python LitePoint Test Failed."
  exit $rc
fi

echo "Python LitePoint Test Passed."
exit 0
