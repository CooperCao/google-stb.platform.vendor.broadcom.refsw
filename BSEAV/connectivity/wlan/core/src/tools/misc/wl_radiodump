#!/usr/bin/perl -w
# 	$Id: wl_radiodump,v 12.1 2005-06-03 18:34:48 tima Exp $	
#$ Copyright Broadcom Corporation $
 
use strict;

my %regs = 
    ('2053'=>[0x41, 0x43, 0x52, 0x75, 0x79, 0xff],

     '2050'=>[0x41, 0x42, 0x43, 0x50, 0x51, 0x52, 0x58, 0x5a,
		 0x5b, 0x5c, 0x5d, 0x73, 0x74, 0x75, 0x76, 0x77,
		 0x78, 0x79, 0x7a, 0x84, 0x86, 0x87, 0xe0, 0xe1,
		 0xe2, 0xff],

     '2050sc'=>[0x41, 0x42, 0x43, 0x50, 0x51, 0x52, 0x53, 0x54,
		   0x58, 0x5a, 0x5b, 0x5c, 0x5d, 0x5e, 0x73, 0x74,
		   0x75, 0x76, 0x77, 0x78, 0x79, 0x7a, 0x7b, 0x7c,
		   0x7d, 0x84, 0x87, 0xe0, 0xe1, 0xe2, 0xff],

     '2050r6'=>[0x41, 0x42, 0x43, 0x50, 0x51, 0x52, 0x53, 0x54,
		   0x58, 0x5a, 0x5b, 0x5c, 0x5d, 0x5e, 0x73, 0x74,
		   0x75, 0x76, 0x77, 0x78, 0x79, 0x7a, 0x7b, 0x7c,
		   0x7d, 0x83, 0x84, 0x85, 0x86, 0x87, 0xe0, 0xe1,
		   0xe2, 0xe3, 0xe4, 0x7e, 0xff],

     '2060ww'=>[0x02, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a,
		   0x0b, 0x0c, 0x0d, 0x0e, 0x0f, 0x10, 0x11, 0x12,
		   0x13, 0x14, 0x15, 0x16, 0x17, 0x18, 0x19, 0x1a,
		   0x1b, 0x1c, 0x1d, 0x1e, 0x1f, 0x20, 0x21, 0x22,
		   0x23, 0x24, 0x25, 0x26, 0x27, 0x28, 0x29, 0x2a,
		   0x2b, 0x2c, 0x2d, 0x2e, 0x2f, 0x30, 0x31, 0x32,
		   0x33, 0x34, 0x35, 0x36, 0x37, 0x38, 0x39, 0x3a,
		   0x3b, 0x3c, 0x3d, 0x3e, 0x3f, 0x80, 0x81, 0x82,
		   0x83, 0x84, 0x85, 0xff],
     );

my($radioid, $radiorev);
open(DUMP, "wl dump|") or die "Can't run wl dump: $!\n";
while(<DUMP>) {
    if(($radioid, $radiorev)=/radioid\s(0x\d+)\sradiorev\s(0x\d+)/) {
	last;
    }
}
close DUMP;
die "radioid not found\n" unless defined $radioid;
die "radiorev not found\n" unless defined $radiorev;

my $regs;
my $name;

if($radioid eq '0x2050') {
    if(oct($radiorev) >=4 && oct($radiorev) <=5) {
	$regs = $regs{'2050sc'};
	$name = "2050sc";
    } elsif($radiorev eq '0x8') {
	$regs = $regs{'2050r6'};
	$name = "2050r8";
    } else {
	$regs = $regs{'2050'};
	$name = "2050";
    }
} elsif ($radioid eq '0x2060') {
    $regs = $regs{'2060ww'};
    $name = "2060ww";
} else {
    $regs = $regs{'2053'};
    $name = "2053";
}

foreach my $r (1,@$regs) {
    last if $r == 0xff;
    my $v=`wl radioreg $r`;
    chop $v;
    printf("$name: 0x%03x 0x%04x\n", $r, oct($v));
}
exit;

=head1 NAME

wl_radiodump - emulate wl radiodump for external wl driver

=head1 SYNOPSIS

src/tools/misc/wl_radiodump

=head1 DESCRIPTION

The B<wl radiodump> command only works on I<internal> debugging
versions of the B<wl> driver since it relies on B<BCMINERNAL> code.
The B<wl_radiodump> script attempts to duplicate B<radiodump> output
using B<radioreg> which is still available in I<external> debugging
versions of the driver.

B<This script should not be distributed outside of Broadcom.>

=head1 BUGS

The script only returns the low order 16bits of the 32bit Chip ID at
address 0x001.

The script will need to be updated when B<wlc_dump_radioregs> and its
associated tables are updated.

=head1 SEE ALSO

L<wl_phydump(1)>

=head1 AUTHOR

Tim Auckland <tima@broadcom.com>

=cut
