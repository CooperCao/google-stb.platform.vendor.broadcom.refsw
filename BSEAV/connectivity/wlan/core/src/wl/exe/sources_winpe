# sources: Windows PE build file for petool.exe
# 
# Copyright (C) 2005 Broadcom Corporation
# All Rights Reserved.
#
# $Id: sources_winpe,v 1.5 2009-07-30 19:34:44 $
#

NIC_WL_EXE=pet
TARGETPATH=windows/winpe/obj/winpe
TARGETNAME=$(NIC_WL_EXE)
TARGETTYPE=EXE
SUBSYSTEM=console
REQUIRE_WDM7600=1
REQUIRE_SDK60=1

C_DEFINES += -DD11AC_IOTYPES -DPPR_API

ifeq ($(DDKBUILDENV), checked)

#ifdef WLEXTLOG
C_DEFINES += -DWLEXTLOG
#endif

endif

RWL		?= 1

vpath %.c $(SRCBASE)/shared $(SRCBASE)/tools/epictrl $(WLAN_StdSrcDirsR) $(WLAN_ComponentSrcDirsR)

SOURCES    = wlu_common.c \
	     wlu.c \
	     wlu_rates_matrix.c \
             wlu_cmd.c \
             wlc_ppr.c \
             wlu_iov.c \
             wlu_ndis.c \
             bcmutils.c \
             bcmwifi_channels.c \
             bcmstdlib.c \
             wlu_client_shared.c \
             wlu_pipe.c \
             wlu_pipe_win32.c \
             miniopt.c \
             bcmxtlv.c \
             bcm_app_utils.c \
             hwdiags_winpe.c \
             ir.c \
             irhelper.c \
             ir_wmi.c \
             regnt4.c \
             driveloader.c \
             win9x2k.c \
             wlu_subcounters.c

INCLUDES   = $(SRCBASE);$(SRCBASE)/include;$(SRCBASE)/../components/shared;$(SRCBASE)/wl/sys;$(subst $(space),;,$(WLAN_ComponentIncDirs));$(subst $(space),;,$(WLAN_StdIncDirsA));

TARGETLIBS =  wsock32.lib ADVAPI32.LIB Setupapi.lib IPHlpApi.Lib

ifeq ($(WLTEST),1)
C_DEFINES += -DSERDOWNLOAD
endif

#if any of the transport flags are set then others transports will be disabled
ifeq ($(RWL_WIFI),1)
C_DEFINES += -DRWL_WIFI
RWL=0
endif

ifeq ($(RWL_SOCKET),1)
C_DEFINES += -DRWL_SOCKET
RWL=0
endif

# By default for RWL enable all transports
ifeq ($(RWL),1)
C_DEFINES += -DRWL_SOCKET -DRWL_WIFI
endif

C_DEFINES += -DWINPE -DWIN32

SOURCES += wluc_phy.c
SOURCES += wluc_wnm.c
SOURCES += wluc_cac.c
SOURCES += wluc_relmcast.c
SOURCES += wluc_rrm.c
SOURCES += wluc_wowl.c
SOURCES += wluc_pkt_filter.c
SOURCES += wluc_mfp.c
SOURCES += wluc_ota_test.c
SOURCES += wluc_bssload.c
SOURCES += wluc_stf.c
SOURCES += wluc_offloads.c
SOURCES += wluc_tpc.c
SOURCES += wluc_toe.c
SOURCES += wluc_arpoe.c
SOURCES += wluc_keep_alive.c
SOURCES += wluc_ap.c
SOURCES += wluc_ampdu.c
SOURCES += wluc_ampdu_cmn.c
SOURCES += wluc_bmac.c
SOURCES += wluc_ht.c
SOURCES += wluc_wds.c
SOURCES += wluc_keymgmt.c
SOURCES += wluc_scan.c
SOURCES += wluc_obss.c
SOURCES += wluc_prot_obss.c
SOURCES += wluc_lq.c
SOURCES += wluc_seq_cmds.c
SOURCES += wluc_btcx.c
SOURCES += wluc_led.c
SOURCES += wluc_interfere.c
SOURCES += wluc_ltecx.c
SOURCES += wluc_he.c

##ifdef WL_NAN
#C_DEFINES += -DWL_NAN
#SOURCES += wluc_nan.c
##endif

#ifdef WLEXTLOG
C_DEFINES += -DWLEXTLOG
SOURCES += wluc_extlog.c
#endif


#ifdef WLNDOE
C_DEFINES += -DWLNDOE
SOURCES += wluc_ndoe.c
#endif

#ifdef WLP2PO
C_DEFINES += -DWLP2PO
SOURCES += wluc_p2po.c
#endif

#idef WLANQPO
C_DEFINES += -DWLANQPO
SOURCES += wluc_anqpo.c
#endif

#idef WLBDO
C_DEFINES += -DWLBDO
SOURCES += wluc_bdo.c
#endif

#idef WLTKO
C_DEFINES += -DWLTKO
SOURCES += wluc_tko.c
#endif

#idef WLPFN
C_DEFINES += -DWLPFN
SOURCES += wluc_pfn.c
#endif

#idef WLP2P
C_DEFINES += -DWLP2P
SOURCES += wluc_p2p.c
#endif

#idef WLTDLS
C_DEFINES += -DWLTDLS
SOURCES += wluc_tdls.c
#endif

#idef TRAFFIC_MGMT
C_DEFINES += -DTRAFFIC_MGMT
SOURCES += wluc_traffic_mgmt.c
#endif

#idef WL_PROXDETECT
C_DEFINES += -DWL_PROXDETECT
SOURCES += wluc_proxd.c
#endif

#idef WL_RANDMAC
C_DEFINES += -DWL_RANDMAC
SOURCES += wluc_randmac.c
#endif

#idef WL_MSCH
C_DEFINES += -DWL_MSCH
SOURCES += wluc_msch.c
#endif

#target :: $(SRCBASE)/tools/epictrl/$(DDKBUILDENV)/bcmctrl.lib

# some local rules
#$(SRCBASE)/tools/epictrl/$(DDKBUILDENV)/bcmctrl.lib : FORCE
#	$(MAKE) -C $(SRCBASE)/tools/epictrl

NTICE_DBG= @echo "local Building SoftIce symbols - $(@:%.dll=%.nms) for i386"; \
	$(NTICE)/nmsym.exe -SOURCE:. -SOURCE:$(SRCBASE)/tools/epictrl $(SI_FLAGS) $@
